<div fxLayout="column" fxFlexFill [style.paddingRight.px]="8" [empNgSpinnerHost]="spinnerRemove">

  <emp-ng-spinner #spinnerRemove [visible]="!displayItemAssign && submitted">

  </emp-ng-spinner>

  <div fxLayout="row">

    <div fxFlex fxLayoutAlign="start center">

      <emp-ng-select *ngIf="selectorRequired"
        name="selectedSelector" [fxFlex]="50"
        [(ngModel)]="selectedSelectorUID" [ngModelOptions]="{standalone: true}"
        [items]="itemsForSelectorList"
        placeholder="Seleccione la aplicaciÃ³n"
        (changes)="onSelectedSelectorChanges($event)">
      </emp-ng-select>

    </div>

    <div *ngIf="canEdit" fxFlex="none" fxLayoutAlign="end center">

      <button
        [disabled]="!isSelectorValid"
        [class.btn]="!isSelectorValid"
        [class.btn-action]="isSelectorValid"
        [style.marginLeft.px]="8"
        (click)="onAssignItemButtonClicked()">
        Agregar {{itemTypeName}}
      </button>

    </div>

  </div>

  <table mat-table [dataSource]="dataSource">

    <ng-container matColumnDef="item">
      <th mat-header-cell *matHeaderCellDef> {{itemTypeName}} </th>
      <td mat-cell *matCellDef="let row"> {{ row.name }} </td>
    </ng-container>

    <ng-container matColumnDef="actionDelete">
      <th mat-header-cell *matHeaderCellDef> </th>
      <td mat-cell *matCellDef="let row" class="column-action">
        <button mat-icon-button>
          <mat-icon [title]="'Eliminar ' +  itemTypeName | lowercase"
            (click)="onRemoveItemClicked(row)">
            delete
          </mat-icon>
        </button>
      </td>
    </ng-container>

    <ng-container matColumnDef="notFoundMessage">
      <td mat-footer-cell *matFooterCellDef [attr.colspan]="displayedColumns.length">
        {{queryExcecuted ? 'No se han agregado elementos.' : 'No se ha invocado la consulta.'}}
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns;"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    <tr mat-footer-row *matFooterRowDef="['notFoundMessage']" class="text-not-found"
      [hidden]="dataSource.data.length > 0"></tr>

  </table>

</div>


<emp-ng-modal-window *ngIf="displayItemAssign" [config]="{width:'750px'}">

  <emp-ng-card
    [title]="'Agregar ' + (itemTypeName | lowercase)"
    hint="Seleccione el elemento a agregar."
    (cardClose)="onCloseItemAssign()">

    <div class="card-body-padding" [empNgSpinnerHost]="spinnerAssign">

      <form #addItemform="ngForm" empNgFormKeyDownEnter
        autocomplete="off" class="form-section">

        <emp-ng-spinner #spinnerAssign [visible]="displayItemAssign && submitted">

        </emp-ng-spinner>

        <div fxLayout="column" fxLayoutGap="0.75rem" fxLayoutGap.lt-md="0.75rem">

          <div *ngIf="itemsToAssignValidsList.length === 0" class="instruction-text">
            No se encontraron elementos a agregar.
          </div>

          <div *ngIf="itemsToAssignValidsList.length > 0" class="items-container">

            <mat-radio-group
              [(ngModel)]="itemToAssign" required
              name="itemToAssign" class="radio-group-vertical">

              <mat-radio-button *ngFor="let item of itemsToAssignValidsList"
                [value]="item"
                class="radio-button-vertical">
                {{item.name}}
              </mat-radio-button>

            </mat-radio-group>

          </div>

          <mat-divider></mat-divider>

          <div #rowFooter fxLayout="row">

            <div fxFlex fxLayoutAlign="end center">

              <button
                [disabled]="!isItemToAssignValid"
                [class.btn]="!isItemToAssignValid"
                [class.btn-action]="isItemToAssignValid"
                (click)="onAssignItem()">
                Agregar
              </button>

            </div>

          </div>

        </div>

      </form>

    </div>

  </emp-ng-card>

</emp-ng-modal-window>
